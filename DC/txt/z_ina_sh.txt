z_ina_sh01:--z_ina_sh01
SET QUOTED_IDENTIFIER OFF
declare @tmp table(
	gno nvarchar(1), 
	datea nvarchar(10),
	noa nvarchar(50),
	custno nvarchar(50),
	comp nvarchar(100),					
	rr int,
	productno nvarchar(50),
	product nvarchar(100),
	gweight float,
	spec nvarchar(100),
	mount float,
	unit nvarchar(50),
	typea nvarchar(50),
	memo nvarchar(max),							
	meno nvarchar(max),
	tranmoney float,
	price float,
	overpay float
)
insert @tmp
select '1',b.datea,b.noa,b.custno,b.cust,ROW_NUMBER()over(partition by b.noa order by a.product)
,a.productno,a.product,a.mweight,a.spec,a.mount,a.unit,a.typea,a.memo,b.memo,b.tranmoney,b.price,b.overpay
from view_inas a left join view_ina b on a.noa=b.noa

insert @tmp(gno,rr,noa,gweight,spec,mount,unit)
select '2',99998,noa,SUM(gweight),spec,sum(mount),unit
from @tmp
group by noa,spec,unit

insert @tmp(gno,rr,noa)
select '3',99999,noa
from @tmp
group by noa

select * from @tmp
order by noa,rr
;

